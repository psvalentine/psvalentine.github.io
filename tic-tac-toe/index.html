<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéÆ</text></svg>">
    <style>
        :root {
            --bg-color: #1a1a2e;
            --cell-bg: #16213e;
            --cell-hover: #0f3460;
            --text-color: #e94560;
            --accent-x: #4cc9f0;
            --accent-o: #f72585;
            --text-main: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            user-select: none;
        }

        h1 { 
            margin-bottom: 30px; 
            font-weight: bold; 
            letter-spacing: 2px;
            background-color: var(--text-color);
            padding: 15px 40px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.4);
            font-size: 1.5rem;
            text-transform: uppercase;
            text-align: center;
        }

        .game-container {
            display: flex;
            gap: 50px;
            align-items: flex-start;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* –ü–∞–Ω–µ–ª—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .stats-panel {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 20px;
            min-width: 260px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 1.1rem;
        }

        .stat-value { font-weight: bold; color: var(--text-color); }

        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ */
        .controls {
            margin-top: 25px;
            display: flex;
            flex-direction: column;
            align-items: center; 
            gap: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 20px;
        }

        .control-group {
            width: 100%;
            text-align: center;
            position: relative; /* –í–∞–∂–Ω–æ –¥–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ */
            z-index: 10;
        }

        /* –ß—Ç–æ–±—ã –≤–µ—Ä—Ö–Ω–∏–π —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–ª –Ω–∏–∂–Ω–∏–π –ø—Ä–∏ —Ä–∞—Å–∫—Ä—ã—Ç–∏–∏ */
        .control-group:first-of-type {
            z-index: 20;
        }

        .control-label {
            font-size: 0.85rem;
            opacity: 0.7;
            margin-bottom: 8px;
            display: block;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* --- –ö–ê–°–¢–û–ú–ù–´–ï –í–´–ü–ê–î–ê–Æ–©–ò–ï –°–ü–ò–°–ö–ò --- */
        .custom-dropdown {
            position: relative;
            width: 100%;
            font-family: inherit;
        }

        /* –ö–Ω–æ–ø–∫–∞ –≤—ã–±–æ—Ä–∞ (–∑–∞–∫—Ä—ã—Ç—ã–π —Å–ø–∏—Å–æ–∫) */
        .dropdown-selected {
            background-color: transparent;
            border: 2px solid var(--text-color);
            border-radius: 50px;
            padding: 12px 20px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            position: relative;
        }

        /* –°—Ç—Ä–µ–ª–æ—á–∫–∞ */
        .dropdown-selected:after {
            content: "";
            position: absolute;
            right: 20px;
            top: 45%;
            width: 8px;
            height: 8px;
            border: 2px solid white;
            border-top: none;
            border-right: none;
            transform: rotate(-45deg) translateY(-50%);
            transition: transform 0.3s ease;
        }

        /* –ü–æ–≤–æ—Ä–æ—Ç —Å—Ç—Ä–µ–ª–æ—á–∫–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ */
        .custom-dropdown.open .dropdown-selected:after {
            transform: rotate(135deg) translateY(-50%);
            top: 50%;
        }

        .dropdown-selected:hover {
            background-color: rgba(233, 69, 96, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(233, 69, 96, 0.3);
        }

        /* –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é */
        .dropdown-options {
            position: absolute;
            top: 115%;
            left: 0;
            right: 0;
            background-color: #222238; /* –ß—É—Ç—å —Å–≤–µ—Ç–ª–µ–µ —Ñ–æ–Ω–∞ */
            border: 2px solid var(--text-color);
            border-radius: 20px;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-15px);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }

        .custom-dropdown.open .dropdown-options {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        /* –≠–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞ */
        .dropdown-option {
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            font-weight: 500;
            color: #ddd;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .dropdown-option:last-child {
            border-bottom: none;
        }

        .dropdown-option:hover {
            background-color: var(--text-color);
            color: white;
            padding-left: 20px; /* –≠—Ñ—Ñ–µ–∫—Ç —Å–¥–≤–∏–≥–∞ */
        }

        .dropdown-option.selected {
            background-color: rgba(233, 69, 96, 0.2);
            color: white;
            font-weight: bold;
        }

        /* --- –ö–û–ù–ï–¶ –ö–ê–°–¢–û–ú–ù–´–• –°–ü–ò–°–ö–û–í --- */

        /* –î–æ—Å–∫–∞ */
        .board {
            display: grid;
            gap: 10px;
            background-color: var(--bg-color);
            padding: 10px;
            border-radius: 15px;
            transition: all 0.3s ease;
        }

        .cell {
            background-color: var(--cell-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.2s ease;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
        }

        .cell:hover { background-color: var(--cell-hover); transform: scale(1.02); }
        
        .cell.x { color: var(--accent-x); text-shadow: 0 0 10px rgba(76, 201, 240, 0.5); }
        .cell.o { color: var(--accent-o); text-shadow: 0 0 10px rgba(247, 37, 133, 0.5); }
        
        .cell span {
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .status {
            margin-top: 20px;
            font-size: 1.3rem;
            height: 30px;
            color: #ddd;
            font-weight: 500;
            text-align: center;
            min-width: 200px;
        }

        .btn-main {
            margin-top: 25px;
            padding: 12px 40px;
            font-size: 1.1rem;
            cursor: pointer;
            background-color: var(--text-color);
            border: none;
            border-radius: 50px;
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.4);
            transition: transform 0.1s, box-shadow 0.2s, background-color 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-main:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(233, 69, 96, 0.6);
            background-color: #d63d56;
        }

        .btn-main:active { transform: translateY(0); }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 750px) {
            .game-container { flex-direction: column-reverse; align-items: center; gap: 30px; }
            h1 { font-size: 1.2rem; padding: 12px 30px; margin-bottom: 20px; }
            .board { gap: 5px; }
        }
    </style>
</head>
<body>

    <h1>–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏</h1>

    <div class="game-container">
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div class="stats-panel">
            <div style="text-align: center; margin-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; font-size: 1.2rem; font-weight: bold;">–°–¢–ê–¢–ò–°–¢–ò–ö–ê</div>
            <div class="stat-item">
                <span id="label-player1">–ò–≥—Ä–æ–∫:</span>
                <span class="stat-value" id="score-player">0</span>
            </div>
            <div class="stat-item">
                <span id="label-player2">–ë–æ—Ç:</span>
                <span class="stat-value" id="score-bot">0</span>
            </div>
            <div class="stat-item">
                <span>–ù–∏—á—å–∏:</span>
                <span class="stat-value" id="score-draw">0</span>
            </div>

            <div class="controls">
                <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–π –≤—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ -->
                <div class="control-group">
                    <span class="control-label">–†–µ–∂–∏–º –∏–≥—Ä—ã</span>
                    <div class="custom-dropdown" id="mode-dropdown">
                        <div class="dropdown-selected">–ü—Ä–æ—Ç–∏–≤ –ë–æ—Ç–∞</div>
                        <div class="dropdown-options">
                            <div class="dropdown-option selected" data-value="pve">–ü—Ä–æ—Ç–∏–≤ –ë–æ—Ç–∞</div>
                            <div class="dropdown-option" data-value="pvp">–í–¥–≤–æ–µ–º</div>
                        </div>
                    </div>
                </div>
                
                <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–π –≤—ã–±–æ—Ä —Ä–∞–∑–º–µ—Ä–∞ -->
                <div class="control-group">
                    <span class="control-label">–†–∞–∑–º–µ—Ä –ø–æ–ª—è</span>
                    <div class="custom-dropdown" id="size-dropdown">
                        <div class="dropdown-selected">3 x 3</div>
                        <div class="dropdown-options">
                            <div class="dropdown-option selected" data-value="3">3 x 3</div>
                            <div class="dropdown-option" data-value="4">4 x 4</div>
                            <div class="dropdown-option" data-value="5">5 x 5</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ -->
        <div style="display: flex; flex-direction: column; align-items: center;">
            <div class="status" id="status"></div>
            <div class="board" id="board">
                <!-- –Ø—á–µ–π–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è JS -->
            </div>
            <button class="btn-main" id="restart-btn" onclick="startGame()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
        </div>
    </div>

    <script>
        /* --- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ --- */
        const boardElement = document.getElementById('board');
        const statusElement = document.getElementById('status');
        const btnElement = document.getElementById('restart-btn');
        
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ select, —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        let board = [];
        let gameActive = false;
        let isFirstLaunch = true;
        let isPvP = false; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é PvE
        let boardSize = 3; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 3x3
        
        const X_SYMBOL = 'X';
        const O_SYMBOL = 'O';
        const COLOR_X = "#4cc9f0";
        const COLOR_O = "#f72585";
        
        let humanSide = X_SYMBOL; 
        let botSide = O_SYMBOL;
        let currentPlayer = X_SYMBOL; 

        let stats = { player1: 0, player2: 0, draw: 0 };

        /* --- –õ–æ–≥–∏–∫–∞ –ö–∞—Å—Ç–æ–º–Ω—ã—Ö –í—ã–ø–∞–¥–∞—é—â–∏—Ö –°–ø–∏—Å–∫–æ–≤ --- */
        function setupDropdowns() {
            const dropdowns = document.querySelectorAll('.custom-dropdown');
            
            dropdowns.forEach(dropdown => {
                const selected = dropdown.querySelector('.dropdown-selected');
                const options = dropdown.querySelectorAll('.dropdown-option');

                // –û—Ç–∫—Ä—ã—Ç–∏–µ/–ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É
                selected.addEventListener('click', (e) => {
                    e.stopPropagation();
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ —Å–ø–∏—Å–∫–∏
                    dropdowns.forEach(d => {
                        if (d !== dropdown) d.classList.remove('open');
                    });
                    dropdown.classList.toggle('open');
                });

                // –í—ã–±–æ—Ä –æ–ø—Ü–∏–∏
                options.forEach(option => {
                    option.addEventListener('click', (e) => {
                        e.stopPropagation();
                        // –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                        selected.innerText = option.innerText;
                        options.forEach(o => o.classList.remove('selected'));
                        option.classList.add('selected');
                        dropdown.classList.remove('open');
                        
                        // –õ–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–≥—Ä—ã
                        const val = option.getAttribute('data-value');
                        if (dropdown.id === 'mode-dropdown') {
                            isPvP = (val === 'pvp');
                            changeConfig();
                        } else if (dropdown.id === 'size-dropdown') {
                            boardSize = parseInt(val);
                            changeConfig();
                        }
                    });
                });
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ —Å–ø–∏—Å–∫–∞
            document.addEventListener('click', () => {
                dropdowns.forEach(d => d.classList.remove('open'));
            });
        }

        /* --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –°–±—Ä–æ—Å --- */
        function initBoard() {
            // –¢–µ–ø–µ—Ä—å boardSize –±–µ—Ä–µ—Ç—Å—è –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
            board = Array(boardSize * boardSize).fill("");
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CSS —Å–µ—Ç–∫–∏
            boardElement.style.gridTemplateColumns = `repeat(${boardSize}, 1fr)`;
            boardElement.style.gridTemplateRows = `repeat(${boardSize}, 1fr)`;
            
            // –û—á–∏—Å—Ç–∫–∞ HTML
            boardElement.innerHTML = '';
            
            // –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –∫–ª–µ—Ç–æ–∫ –ø–æ–¥ —Ä–∞–∑–º–µ—Ä –ø–æ–ª—è
            let cellSize = 100; // default for 3x3
            let fontSize = 3.5;

            if (boardSize === 4) { cellSize = 80; fontSize = 2.5; }
            if (boardSize === 5) { cellSize = 65; fontSize = 2; }

            for (let i = 0; i < boardSize * boardSize; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.setAttribute('data-index', i);
                cell.style.width = `${cellSize}px`;
                cell.style.height = `${cellSize}px`;
                cell.style.fontSize = `${fontSize}rem`;
                cell.addEventListener('click', handleCellClick);
                boardElement.appendChild(cell);
            }
        }

        function changeConfig() {
            // –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å –ø—Ä–∏ —Å–º–µ–Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
            stats = { player1: 0, player2: 0, draw: 0 };
            document.getElementById('score-player').innerText = 0;
            document.getElementById('score-bot').innerText = 0;
            document.getElementById('score-draw').innerText = 0;
            
            // –¢–µ–ø–µ—Ä—å isPvP —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º —Å–ø–∏—Å–∫–∞
            isFirstLaunch = true; 
            
            // –õ–µ–π–±–ª—ã
            document.getElementById('label-player1').innerText = isPvP ? "–ò–≥—Ä–æ–∫ 1 (X):" : "–ò–≥—Ä–æ–∫:";
            document.getElementById('label-player2').innerText = isPvP ? "–ò–≥—Ä–æ–∫ 2 (O):" : "–ë–æ—Ç:";
            
            btnElement.innerText = "–ù–æ–≤–∞—è –∏–≥—Ä–∞";
            statusElement.innerText = "";
            
            initBoard(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –ø–æ–ª—è
            gameActive = false;
        }

        function startGame() {
            if (isFirstLaunch) {
                btnElement.innerText = "–ó–∞–Ω–æ–≤–æ";
                isFirstLaunch = false;
            } else {
                if (!isPvP) {
                    humanSide = humanSide === X_SYMBOL ? O_SYMBOL : X_SYMBOL;
                    botSide = botSide === X_SYMBOL ? O_SYMBOL : X_SYMBOL;
                }
            }

            // –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º –ø—É—Å—Ç—É—é –¥–æ—Å–∫—É (–ª–æ–≥–∏—á–µ—Å–∫–∏)
            board = Array(boardSize * boardSize).fill("");
            gameActive = true;
            currentPlayer = X_SYMBOL; 

            // –û—á–∏—Å—Ç–∫–∞ UI
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                cell.innerHTML = "";
                cell.classList.remove('x', 'o');
                cell.style.backgroundColor = "";
            });

            updateStatus();

            if (!isPvP && botSide === X_SYMBOL) {
                setTimeout(botTurn, 600);
            }
        }

        function updateStatus() {
            if (!gameActive) return;

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–∏–º–≤–æ–ª–∞ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
            const currentColor = currentPlayer === X_SYMBOL ? COLOR_X : COLOR_O;
            statusElement.style.color = currentColor;

            if (isPvP) {
                statusElement.innerText = `–•–æ–¥: ${currentPlayer === X_SYMBOL ? "–ò–≥—Ä–æ–∫ 1 (X)" : "–ò–≥—Ä–æ–∫ 2 (O)"}`;
            } else {
                if (currentPlayer === humanSide) {
                    statusElement.innerText = `–í–∞—à —Ö–æ–¥ (${humanSide})`;
                } else {
                    statusElement.innerText = `–î—É–º–∞–µ—Ç –±–æ—Ç (${botSide})...`;
                }
            }
        }

        /* --- –ò–≥—Ä–æ–≤–æ–π –ø—Ä–æ—Ü–µ—Å—Å --- */
        function handleCellClick(e) {
            const index = parseInt(e.target.getAttribute('data-index'));

            if (board[index] !== "" || !gameActive) return;
            if (!isPvP && currentPlayer !== humanSide) return;

            makeMove(index, currentPlayer);
        }

        function makeMove(index, symbol) {
            board[index] = symbol;
            const cell = document.querySelector(`[data-index='${index}']`);
            
            cell.innerHTML = `<span>${symbol}</span>`;
            cell.classList.add(symbol.toLowerCase());
            
            if (checkWin(board, symbol, boardSize)) {
                endGame(false, symbol);
            } else if (!board.includes("")) {
                endGame(true);
            } else {
                currentPlayer = currentPlayer === X_SYMBOL ? O_SYMBOL : X_SYMBOL;
                updateStatus();
                
                if (!isPvP && currentPlayer === botSide && gameActive) {
                    setTimeout(botTurn, 500);
                }
            }
        }

        function endGame(isDraw, winnerSymbol = null) {
            gameActive = false;
            
            if (isDraw) {
                statusElement.innerText = "–ù–∏—á—å—è!";
                statusElement.style.color = "#ddd";
                stats.draw++;
                document.getElementById('score-draw').innerText = stats.draw;
            } else {
                let isPlayer1Win;
                // –¶–≤–µ—Ç –ø–æ–±–µ–¥—ã —Ç–µ–ø–µ—Ä—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–∏–º–≤–æ–ª–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
                const winColor = winnerSymbol === X_SYMBOL ? COLOR_X : COLOR_O;

                if (isPvP) {
                    isPlayer1Win = (winnerSymbol === X_SYMBOL);
                    statusElement.innerText = isPlayer1Win ? "–ü–æ–±–µ–¥–∏–ª –ò–≥—Ä–æ–∫ 1!" : "–ü–æ–±–µ–¥–∏–ª –ò–≥—Ä–æ–∫ 2!";
                } else {
                    isPlayer1Win = (winnerSymbol === humanSide);
                    statusElement.innerText = isPlayer1Win ? "–ü–æ–±–µ–¥–∞!" : "–ü–æ—Ä–∞–∂–µ–Ω–∏–µ!";
                }

                statusElement.style.color = winColor;
                
                if (isPlayer1Win) {
                    stats.player1++;
                    document.getElementById('score-player').innerText = stats.player1;
                } else {
                    stats.player2++;
                    document.getElementById('score-bot').innerText = stats.player2;
                }
                
                // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–∏–≥—Ä—ã—à–Ω–æ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Ü–≤–µ—Ç–æ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
                highlightWin(winnerSymbol, winColor);
            }
            btnElement.innerText = "–ó–∞–Ω–æ–≤–æ";
        }

        /* --- –õ–æ–≥–∏–∫–∞ –ø–æ–±–µ–¥—ã (–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –¥–ª—è –ª—é–±—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤) --- */
        function checkWin(currentBoard, player, size) {
            // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏
            for (let i = 0; i < size * size; i += size) {
                if (checkLine(currentBoard, player, i, 1, size)) return true;
            }
            // –í–µ—Ä—Ç–∏–∫–∞–ª–∏
            for (let i = 0; i < size; i++) {
                if (checkLine(currentBoard, player, i, size, size)) return true;
            }
            // –î–∏–∞–≥–æ–Ω–∞–ª–∏
            if (checkLine(currentBoard, player, 0, size + 1, size)) return true;
            if (checkLine(currentBoard, player, size - 1, size - 1, size)) return true;

            return false;
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–Ω–∏–∏
        function checkLine(b, player, start, step, count) {
            for (let i = 0; i < count; i++) {
                if (b[start + i * step] !== player) return false;
            }
            return true;
        }

        function highlightWin(winner, color) {
             const size = boardSize;
             const winLines = [];
             
             // Rows
             for (let i = 0; i < size * size; i += size) {
                 let line = []; for(let k=0; k<size; k++) line.push(i+k);
                 winLines.push(line);
             }
             // Cols
             for (let i = 0; i < size; i++) {
                 let line = []; for(let k=0; k<size; k++) line.push(i + k*size);
                 winLines.push(line);
             }
             // Diagonals
             let d1 = []; for(let k=0; k<size; k++) d1.push(k*(size+1));
             winLines.push(d1);
             let d2 = []; for(let k=0; k<size; k++) d2.push((k+1)*(size-1));
             winLines.push(d2);

             winLines.forEach(line => {
                 if (line.every(idx => board[idx] === winner)) {
                     line.forEach(idx => {
                         const cell = document.querySelector(`[data-index='${idx}']`);
                         if(cell) cell.style.backgroundColor = color;
                     });
                 }
             });
        }

        /* --- AI (Minimax —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π) --- */
        function botTurn() {
            if (!gameActive) return;
            
            // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≥–ª—É–±–∏–Ω—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–æ—Å–æ–∫
            let depthLimit = 100;
            if (boardSize === 4) depthLimit = 4; // 4x4 —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º
            if (boardSize === 5) depthLimit = 3; // 5x5 –µ—â–µ –±–æ–ª—å—à–µ

            // –ü–µ—Ä–≤—ã–π —Ö–æ–¥ –¥–µ–ª–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ –∏–ª–∏ –≤ —Ü–µ–Ω—Ç—Ä, —á—Ç–æ–±—ã –Ω–µ –∂–¥–∞—Ç—å –ø—Ä–æ—Å—á–µ—Ç–∞
            const emptyCells = board.filter(s => s === "").length;
            if (emptyCells === boardSize * boardSize) {
                const center = Math.floor(board.length / 2);
                makeMove(center, botSide);
                return;
            }

            // –î–ª—è 3x3 –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ–±–æ—Ä (–Ω–µ–ø–æ–±–µ–¥–∏–º—ã–π)
            // –î–ª—è 4x4 –∏ 5x5 - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –ø–æ –≥–ª—É–±–∏–Ω–µ (—Å–∏–ª—å–Ω—ã–π, –Ω–æ –±—ã—Å—Ç—Ä—ã–π)
            const moveIndex = getBestMove(depthLimit);
            makeMove(moveIndex, botSide);
        }

        function getBestMove(depthLimit) {
            let bestScore = -Infinity;
            let move = -1;
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ö–æ–¥—ã
            let availableMoves = [];
            board.forEach((v, i) => { if (v === "") availableMoves.push(i); });

            // –ï—Å–ª–∏ –ø–æ–ª–µ –±–æ–ª—å—à–æ–µ –∏ –ø—É—Å—Ç–æ–µ, Minimax –¥–æ–ª–≥–æ –¥—É–º–∞–µ—Ç. –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º —Ö–æ–¥—ã –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
            availableMoves.sort(() => Math.random() - 0.5);

            for (let i of availableMoves) {
                board[i] = botSide;
                let score = minimax(board, 0, false, -Infinity, Infinity, depthLimit);
                board[i] = "";
                if (score > bestScore) {
                    bestScore = score;
                    move = i;
                }
            }
            return move;
        }

        const scores = { win: 1000, loss: -1000, tie: 0 };

        function minimax(currentBoard, depth, isMaximizing, alpha, beta, depthLimit) {
            if (checkWin(currentBoard, botSide, boardSize)) return scores.win - depth;
            if (checkWin(currentBoard, humanSide, boardSize)) return scores.loss + depth;
            if (!currentBoard.includes("")) return scores.tie;
            if (depth >= depthLimit) return 0; // –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –≥–ª—É–±–∏–Ω—ã (–Ω–∏—á—å—è –≤ –≥–ª–∞–∑–∞—Ö –±–æ—Ç–∞ –Ω–∞ —ç—Ç–æ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–µ)

            if (isMaximizing) {
                let maxEval = -Infinity;
                for (let i = 0; i < currentBoard.length; i++) {
                    if (currentBoard[i] === "") {
                        currentBoard[i] = botSide;
                        let eval = minimax(currentBoard, depth + 1, false, alpha, beta, depthLimit);
                        currentBoard[i] = "";
                        maxEval = Math.max(maxEval, eval);
                        alpha = Math.max(alpha, eval);
                        if (beta <= alpha) break;
                    }
                }
                return maxEval;
            } else {
                let minEval = Infinity;
                for (let i = 0; i < currentBoard.length; i++) {
                    if (currentBoard[i] === "") {
                        currentBoard[i] = humanSide;
                        let eval = minimax(currentBoard, depth + 1, true, alpha, beta, depthLimit);
                        currentBoard[i] = "";
                        minEval = Math.min(minEval, eval);
                        beta = Math.min(beta, eval);
                        if (beta <= alpha) break;
                    }
                }
                return minEval;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤
        setupDropdowns();
        // –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
        initBoard(); 
    </script>
</body>

</html>
